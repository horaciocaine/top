<div id="decorator-plugin-howto">


  <h1 class="topictitle1">Providing Your Own Replacements Lookup for the Decorator</h1>

  
  
  <div>
<p>
    Filling an array with replacements may not be the best solution for providing
    replacement information to the decorator.  If you have a more elegant algorithm
    that performs replacement lookups on-the-fly you may provide your own implementation.
  </p>

    <p>
      Providing your own replacements lookup implementation for the Decorator is simply a matter
      of passing an instance of <samp class="codeph">Swift_Plugins_Decorator_Replacements</samp> to the
      decorator plugin's constructor, rather than passing in an array.
    </p>

    
    <p>
      The Replacements interface is very simple to implement since it has just one method:
      <samp class="codeph">getReplacementsFor($address)</samp>.
    </p>

    
    <p>
      Imagine you want to look up replacements from a database on-the-fly, you might provide
      an implementation that does this.  You need to create a small class.
    </p>


<pre class="kodify php">
class DbReplacements implements Swift_Plugins_Decorator_Replacements {
  public function getReplacementsFor($address) {
    $sql = sprintf(
      "SELECT * FROM user WHERE email = '%s'",
      mysql_real_escape_string($address)
    );
    
    $result = mysql_query($sql);
    
    if ($row = mysql_fetch_assoc($result)) {
      return array(
        '{username}'=&gt;$row['username'],
        '{password}'=&gt;$row['password']
      );
    }
  }
}
</pre>


    <p>
      Now all you need to do is pass an instance of your class into the Decorator plugin's
      constructor instead of passing an array.
    </p>

    
<pre class="kodify php">
$decorator = new Swift_Plugins_DecoratorPlugin(new DbReplacements());

$mailer-&gt;registerPlugin($decorator);

</pre>

    
    <p>
      For each message sent, the plugin will call your class' <samp class="codeph">getReplacementsFor()</samp>
      method to find the array of replacements it needs.
    </p>

    
    <div class="note">
<span class="notetitle">Note:</span> 
      If your lookup algorithm is case sensitive, you should transform the <samp class="codeph">$address</samp>
      argument as appropriate â€“ for example by passing it through <samp class="codeph">strtolower()</samp>.
    </div>

    
  </div>

<div>
<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a href="decorator-plugin" title="Often there's a need to send the same message to multiple recipients, but with tiny variations such as the recipient's name being used inside the message body. The Decorator plugin aims to provide a solution for allowing these small differences.">Decorator Plugin</a>
</div>
<div class="previouslink">
<strong>Previous topic:</strong> <a href="decorator-plugin-howto" title="To use the Decorator plugin, simply create an associative array of replacements based on email addresses and then use the mailer's registerPlugin() method to add the plugin.">Using the Decorator Plugin</a>
</div>
</div>
</div>

</div>
