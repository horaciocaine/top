<div id="decorator-plugin-howto">


  <h1 class="topictitle1">Using the Decorator Plugin</h1>

  
  
  <div>
<p>
    To use the Decorator plugin, simply create an associative array of replacements based
    on email addresses and then use the mailer's <samp class="codeph">registerPlugin()</samp> method
    to add the plugin.
  </p>

    <p>
      First create an associative array of replacements based on the email addresses you'll be sending
      the message to.
    </p>

    
    <div class="note">
<span class="notetitle">Note:</span> 
      The replacements array becomes a 2-dimensional array whose keys are the email addreses and whose values
      are an associative array of replacements for that email address.  The curly braces used in this example
      can be any type of syntax you choose, provided they match the placeholders in your email template.
    </div>

    
<pre class="kodify php">
$replacements = array();
foreach ($users as $user) {
  $replacements[$user['email']] = array(
    '{username}'=&gt;$user['username'],
    '{password}'=&gt;$user['password']
  );
}

</pre>

  
    <p>
      Now create an instance of the Decorator plugin using this array of replacements and then register it
      with the Mailer.  Do this only once!
    </p>

    
<pre class="kodify php">
$decorator = new Swift_Plugins_DecoratorPlugin($replacements);

$mailer-&gt;registerPlugin($decorator);

</pre>

    
    <p>
      When you create your message, replace elements in the body (and/or the subject line) with
      your placeholders.
    </p>

    
<pre class="kodify php">

$message = Swift_Message::newInstance()
  -&gt;setSubject('Important notice for {username}')
  -&gt;setBody(
    "Hello {username}, we have reset your password to {password}\n" .
    "Please log in and change it at your earliest convenience."
  )
  ;
  
foreach ($users as $user) {
  $message-&gt;addTo($user['email']);
}

</pre>

    
    <p>
      When you send this message to each of your recipients listed in your <samp class="codeph">$replacements</samp>
      array they will receive a message customized for just themselves.  For example, the message used
      above when received may appear like this to one user:
    </p>

    
<pre class="codeblock">
Subject: Important notice for smilingsunshine2009

Hello smilingsunshine2009, we have reset your password to rainyDays
Please log in and change it at your earliest convenience.

</pre>


    <p>
      While another use may receive the message as:
    </p>

    
<pre class="codeblock">
Subject: Important notice for billy-bo-bob

Hello billy-bo-bob, we have reset your password to dancingOctopus
Please log in and change it at your earliest convenience.

</pre>


    <p>
      While the decorator plugin provides a means to solve this problem, there are various ways you could
      tackle this problem without the need for a plugin.  We're trying to come up with a better way ourselves
      and while we have several (obvious) ideas we don't quite have the perfect solution to go ahead and
      implement it.  Watch this space.
    </p>

    
  </div>

<div>
<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a href="decorator-plugin" title="Often there's a need to send the same message to multiple recipients, but with tiny variations such as the recipient's name being used inside the message body. The Decorator plugin aims to provide a solution for allowing these small differences.">Decorator Plugin</a>
</div>
<div class="nextlink">
<strong>Next topic:</strong> <a href="decorator-plugin-replacements" title="Filling an array with replacements may not be the best solution for providing replacement information to the decorator. If you have a more elegant algorithm that performs replacement lookups on-the-fly you may provide your own implementation.">Providing Your Own Replacements Lookup for the Decorator</a>
</div>
</div>
</div>

</div>
