<div id="throttler-ref">


  <h1 class="topictitle1">Using the Throttler Plugin</h1>

  
  
  <div>
      <p>
    The Throttler Plugin – like all plugins – is added with the Mailer
    class' <samp class="codeph">registerPlugin()</samp> method.  It has two required constructor
    parameters that tell it how to do its rate-limiting.
  </p>

      <div class="section">
         <p>
        To use the Throttler plugin:
      </p>

      </div>

      <ol>
         <li>
            <span>
          Create an instance of the Mailer using any Transport you choose.
        </span>
         </li>

         <li>
            <span>
          Create an instance of the <samp class="codeph">Swift_Plugins_ThrottlerPlugin</samp>
          class, passing the number of emails, or bytes you wish to limit by, along
          with the mode you're using.
        </span>
         </li>

      
         <li>
            <span>
          Register the plugin using the Mailer's <samp class="codeph">registerPlugin()</samp> method.
        </span>
         </li>

      
         <li>
            <span>
          Continue using Swift Mailer to send messages as normal.
        </span>
         </li>

      </ol>

    
      <div class="section">
         <p>
        When Swift Mailer sends messages it will keep track of the rate at which sending
        messages is occuring.  If it realises that sending is happening too fast, it will
        cause your program to <samp class="codeph">sleep()</samp> for enough time to average out
        the rate.
      </p>

         <p>
        Both <samp class="codeph">batchSend()</samp> and <samp class="codeph">send()</samp> methods will
        work with this plugin.
      </p>

      </div>

    
      <div class="example" id="throttler-ref__quickexample">
         <pre class="kodify php">
&lt;?php

require_once 'lib/swift_required.php';

//Create the Mailer using any Transport
$mailer = Swift_Mailer::newInstance(
  Swift_SmtpTransport::newInstance('smtp.example.org', 25)
);

//Rate limit to 100 emails per-minute
$mailer-&gt;registerPlugin(new Swift_Plugins_ThrottlerPlugin(
  100, Swift_Plugins_ThrottlerPlugin::MESSAGES_PER_MINUTE
));

//Rate limit to 10MB per-minute
$mailer-&gt;registerPlugin(new Swift_Plugins_ThrottlerPlugin(
  1024 * 1024 * 10, Swift_Plugins_ThrottlerPlugin::BYTES_PER_MINUTE
));

//Continue sending as normal  
for ($lotsOfRecipients as $recipient) {
  ...
  
  $mailer-&gt;send( ... );
}

</pre>

      </div>

    
  </div>

   <div>
      <div class="familylinks">
         <div class="parentlink">
            <strong>Parent topic:</strong> 
            <a href="throttler-plugin"
               title="If your SMTP server has restrictions in place to limit the rate at which you send emails, then your code will need to be aware of this rate-limiting. The Throttler plugin makes Swift Mailer run at a rate-limited speed.">Throttler Plugin</a>
         </div>
      </div>
   </div>

</div>
